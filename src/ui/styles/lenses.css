/* ==========================================================================
   MYTHIC DIGITAL // LENS SYSTEM
   Codex: main.css
   Architect: Modular CSS Extraction
   
   "Lenses are not filters. They are ways of seeing. 
    They translate the raw chaos of the grid into the ordered truth of the pattern."
   
   This file systematizes the visual transformations of the dataset, 
   moving from hard-coded classes to a token-based overlay system.
========================================================================== 
*/

/* ========================================= */
/* 1. BASE LENS CONTAINER                    */
/* ========================================= */

.lens {
    /* Positioning: Always covers the grid-area */
    position: absolute;
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%;
    
    /* Layering: Above Glyphs (z:5), Below UI Chrome (z:100) */
    z-index: 20;
    
    /* Interaction: Lenses are ethereal by default */
    pointer-events: none;
    
    /* Mythic Defaults */
    opacity: 0;
    transition: opacity 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    mix-blend-mode: normal;
}

/* ========================================= */
/* 2. LENS STATES                            */
/* ========================================= */

.lens--active {
    opacity: 1;
    pointer-events: none; /* Maintain pass-through unless specified */
}

.lens--preview {
    opacity: 0.5;
}

.lens--transitioning {
    transition: all 0.8s ease-in-out;
}

.lens--disabled {
    opacity: 0;
    filter: grayscale(100%);
}

/* ========================================= */
/* 3. LENS TYPES (SEMANTIC MODES)            */
/* ========================================= */

/* TYPE: HEATMAP (The Elemental Aura)
   Context: Conditional Formatting. Hot/Cold logic.
   Aesthetic: Uses the Success/Error spectrum from main.css */
.lens--heatmap {
    /* Subtle color wash to unify the field */
    background: radial-gradient(circle at center, transparent 20%, rgba(20, 30, 25, 0.4) 100%);
    mix-blend-mode: overlay;
}

/* TYPE: TIMELINE (The Temporal Flow)
   Context: Analyzing trends over time.
   Aesthetic: Linear gradients, left-to-right flow. */
.lens--timeline {
    background: linear-gradient(90deg, 
        rgba(27, 31, 27, 0.8) 0%, 
        transparent 20%, 
        transparent 80%, 
        rgba(27, 31, 27, 0.8) 100%
    );
}

/* TYPE: CLUSTER (The Grouping)
   Context: K-Means, segmentation. 
   Aesthetic: Focuses attention, dims the noise (Legacy "Focus" logic). */
.lens--cluster {
    /* No base background, relies on layer masking */
}

/* TYPE: ANOMALY (The Void Scry)
   Context: Outlier detection.
   Aesthetic: Void colors, high contrast, flicker potential. */
.lens--anomaly {
    background: radial-gradient(circle, transparent 50%, rgba(74, 35, 90, 0.2) 100%); /* --void-purple tint */
    box-shadow: inset 0 0 50px rgba(13, 17, 13, 0.8); /* --void-dark vignette */
}

/* TYPE: FLOW (The Gradient)
   Context: Directional magnitude.
   Aesthetic: Smooth transitions, accent-heavy. */
.lens--flow {
    background: linear-gradient(135deg, rgba(33, 115, 70, 0.1), transparent);
}

/* TYPE: PIVOT (The Transformation)
   Context: Rows to Columns. Structural view.
   Aesthetic: Wireframe, "X-Ray" legacy logic. */
.lens--pivot {
    /* X-Ray aesthetic base */
    background-color: rgba(13, 17, 13, 0.85); /* --void-dark opacity */
    backdrop-filter: blur(2px);
}

/* ========================================= */
/* 4. FX LAYERS (THE COMPOSITION)            */
/* ========================================= */

.lens-layer {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none;
}

/* Layer: Veil (Soft Wash) */
.lens-layer--veil {
    background: var(--panel);
    opacity: 0.1;
    mix-blend-mode: multiply;
}

/* Layer: Grid (Tactical Lines) */
.lens-layer--grid {
    background-image: 
        linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    opacity: 0.5;
}

/* Layer: Highlight (Cell Emphasis) */
/* Used for selecting specific regions in the lens */
.lens-layer--highlight {
    border: 1px solid var(--accent);
    box-shadow: 0 0 15px rgba(33, 115, 70, 0.3);
}

/* Layer: Mask (Dimming non-focus areas) */
.lens-layer--mask {
    background: radial-gradient(circle at center, transparent 40%, rgba(0,0,0,0.6) 90%);
}

/* Layer: Contour (Heatmap Borders) */
.lens-layer--contour {
    border: 1px solid rgba(255, 255, 255, 0.05);
}

/* ========================================= */
/* 5. ANIMATIONS (MYTHIC MOTION)             */
/* ========================================= */

.lens-anim--reveal {
    animation: lensReveal 0.6s ease-out;
}

.lens-anim--shift {
    animation: lensShift 4s ease-in-out infinite;
}

.lens-anim--pulse {
    animation: lensPulse 3s infinite;
}

.lens-anim--scanline {
    animation: lensScan 2s linear infinite;
    background: linear-gradient(to bottom, transparent 50%, rgba(33, 115, 70, 0.1) 51%, transparent 52%);
    background-size: 100% 200%;
}

@keyframes lensReveal {
    from { opacity: 0; transform: scale(1.02); }
    to { opacity: 1; transform: scale(1); }
}

@keyframes lensShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

@keyframes lensPulse {
    0% { opacity: 0.8; }
    50% { opacity: 0.4; }
    100% { opacity: 0.8; }
}

@keyframes lensScan {
    0% { background-position: 0% 0%; }
    100% { background-position: 0% 100%; }
}

/* ========================================= */
/* 6. LEGACY BRIDGE                          */
/* ========================================= */
/* Direct extraction of logic from main.css.
   These classes traditionally apply to the .dataset-grid container
   and modify children .grid-cell elements.
*/

/* LEGACY MAPPING: .lens-focus (Now maps to Cluster/Focus logic) */
.dataset-grid.lens-focus .grid-cell:not(:hover) {
    opacity: 0.6;
    filter: blur(1px);
    transition: opacity 0.2s, filter 0.2s;
}

.dataset-grid.lens-focus .grid-cell:hover {
    transform: scale(1.1);
    z-index: 10;
    /* Uses main.css panel/accent vars */
    background: var(--panel); 
    border-color: var(--accent);
    box-shadow: 0 0 15px rgba(0,0,0,0.5);
}

/* LEGACY MAPPING: .lens-xray (Now maps to Pivot/Structure logic) */
.dataset-grid.lens-xray .grid-cell {
    background: transparent;
    border: 1px solid #444;
    color: #aaa;
    /* Note: "Hide formatted backgrounds" logic relies on CSS specificity 
       or JS toggling in the legacy system. */
}

.dataset-grid.lens-xray .grid-cell:hover {
    background: rgba(255,255,255,0.05);
    border-color: #fff;
    color: #fff;
}

.dataset-grid.lens-xray .grid-cell.marked {
    border-color: var(--error);
    color: var(--error);
}

/* LEGACY MAPPING: .lens-summary (The floating label) */
.lens-summary {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(20, 20, 20, 0.9);
    border: 1px solid var(--accent);
    color: var(--text);
    padding: 10px 20px;
    border-radius: 4px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    z-index: 20;
    pointer-events: none;
    font-size: 0.9rem;
    font-family: monospace;
}

/* ========================================= */
/* 7. EXTENDED VISUALS (RENDERER V2)         */
/* ========================================= */
/* Additions for LensRenderer token compatibility */

/* --- STANDARD LENS (The Baseline) --- */
.lens--standard {
    /* Neutral clarity - The Excel default */
    background: transparent;
    /* Ensure it doesn't block clicks */
    pointer-events: none;
}

/* --- HIGHLIGHT TOKENS (Cell-Level) --- */

/* Focus: The cell is selected or central to the lens */
.lens-highlight-focus {
    position: relative;
    z-index: 5;
    border-color: var(--accent-light) !important;
    box-shadow: 0 0 10px rgba(46, 168, 107, 0.4), inset 0 0 0 1px rgba(255,255,255,0.1);
    background: rgba(46, 168, 107, 0.1) !important;
    transition: all 0.3s ease;
}

/* Dim: Recedes into background to let others shine */
.lens-highlight-dim {
    opacity: 0.3;
    filter: grayscale(80%) brightness(0.8);
    transition: opacity 0.4s ease;
    border-color: rgba(255,255,255,0.05) !important;
}

/* Warn: Anomaly or Error state (Void energy) */
.lens-highlight-warn {
    border-color: var(--error) !important;
    color: var(--error) !important;
    background: rgba(231, 76, 60, 0.15) !important;
    box-shadow: 0 0 15px rgba(231, 76, 60, 0.3);
    z-index: 6;
    animation: lensPulseFast 2s infinite;
}

/* Success: Validation or positive flow */
.lens-highlight-success {
    border-color: var(--success) !important;
    color: var(--success) !important;
    background: rgba(46, 204, 113, 0.1) !important;
    box-shadow: 0 0 10px rgba(46, 204, 113, 0.2);
}

/* --- SVG OVERLAYS (Lines & Regions) --- */

.lens-svg-layer {
    filter: drop-shadow(0 0 2px rgba(0,0,0,0.5));
}

/* Base Line Style */
.lens-line {
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
    pointer-events: none;
    transition: opacity 0.3s;
}

/* Flow: Timeline arrows, directional energy */
.lens-line-flow {
    stroke: var(--accent);
    stroke-width: 2px;
    stroke-dasharray: 6 4;
    animation: dashFlow 1s linear infinite;
    opacity: 0.8;
}

/* Ghost: Faint connections, barely visible */
.lens-line-ghost {
    stroke: var(--border-subtle);
    stroke-width: 1px;
    stroke-dasharray: 2 4;
    opacity: 0.3;
}

/* Connection: Standard structural link */
.lens-line-connection {
    stroke: #889988;
    stroke-width: 1.5px;
    opacity: 0.6;
}

/* Region: Cluster bounding boxes */
.lens-region {
    stroke-width: 1px;
    vector-effect: non-scaling-stroke;
    transition: all 0.4s ease;
}

/* Region Focus: The active cluster */
.lens-region-focus {
    fill: rgba(33, 115, 70, 0.05); /* very subtle green wash */
    stroke: var(--accent-light);
    stroke-dasharray: 4 4;
    filter: drop-shadow(0 0 5px rgba(33, 115, 70, 0.2));
}

/* Halo: Anomaly markers */
.lens-halo-warn {
    fill: transparent;
    stroke: var(--error);
    stroke-width: 2px;
    opacity: 0.8;
    transform-origin: center;
    transform-box: fill-box; /* Ensures rotation is around center of the element */
    animation: spinSlow 10s linear infinite; /* Subtle rotation for mythic feel */
}

/* --- ANNOTATIONS (Floating Text) --- */

.lens-annotation {
    position: absolute;
    transform: translate(-50%, -120%); /* Center above cell */
    pointer-events: none;
    user-select: none;
    z-index: 30;
    text-align: center;
    white-space: nowrap;
    text-shadow: 0 1px 2px rgba(0,0,0,0.8);
    transition: opacity 0.3s ease;
}

/* Header: Pivot table labels */
.lens-text-header {
    font-family: 'Segoe UI', sans-serif;
    font-weight: 700;
    font-size: 0.75rem;
    color: var(--text);
    background: var(--panel);
    border: 1px solid var(--border-subtle);
    padding: 2px 8px;
    border-radius: 12px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

/* Rune: Mythic symbols */
.lens-text-rune {
    font-family: serif;
    font-weight: bold;
    font-size: 1.4rem;
    color: var(--rune-gold);
    text-shadow: 0 0 8px rgba(218, 165, 32, 0.6);
    transform: translate(-50%, -150%); /* Lift higher for impact */
}

/* Subtle: Small metadata */
.lens-text-subtle {
    font-family: monospace;
    font-size: 0.7rem;
    color: #889988;
    background: rgba(0,0,0,0.6);
    padding: 1px 4px;
    border-radius: 2px;
    border: 1px solid rgba(255,255,255,0.05);
}

/* --- NEW ANIMATIONS --- */

@keyframes dashFlow {
    to { stroke-dashoffset: -10; }
}

@keyframes lensPulseFast {
    0% { opacity: 0.7; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.05); }
    100% { opacity: 0.7; transform: scale(1); }
}

@keyframes spinSlow {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
